# 视频压缩工具 - 软件需求规格说明书 (SRS)

**版本**: 1.0
**日期**: 2026-01-18
**项目名称**: Video Compressor (视频压缩工具)

---

## 1. 引言

### 1.1 目的
本文档旨在完整描述"视频压缩工具"软件的功能需求、非功能需求和系统约束，为开发、测试和验收提供依据。

### 1.2 范围
本软件是一款基于 PyQt5 图形界面的桌面视频压缩工具，使用 FFmpeg 作为底层编码引擎，支持批量视频压缩、多种压缩模式和丰富的编码参数配置。

### 1.3 定义与缩略语
| 术语 | 说明 |
|------|------|
| FFmpeg | 开源的音视频处理工具 |
| CRF | Constant Rate Factor，恒定质量因子 |
| H.264 | 视频编码标准（AVC） |
| H.265 | 视频编码标准（HEVC） |
| DPI | Dots Per Inch，每英寸点数 |

---

## 2. 总体描述

### 2.1 产品概述
视频压缩工具是一款面向普通用户的桌面应用程序，旨在简化视频压缩操作，让用户无需了解复杂的 FFmpeg 命令行参数即可轻松压缩视频文件。

### 2.2 产品功能概览

```
┌─────────────────────────────────────────────────────────────┐
│                    视频压缩工具 v1.0                         │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │              拖拽区域 / 文件选择                      │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              文件列表（文件名/大小/时长/状态）         │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  压缩设置：                                          │    │
│  │  - 质量等级（高/中/低）                               │    │
│  │  - 压缩模式（按质量/按比例/按大小）                   │    │
│  │  - 高级选项（编码器/分辨率/帧率/码率/音频）           │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  输出设置：输出目录 + 文件后缀                        │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  进度显示：当前文件进度 + 总体进度                    │    │
│  └─────────────────────────────────────────────────────┘    │
│              [ 开始压缩 ]    [ 取消 ]                       │
└─────────────────────────────────────────────────────────────┘
```

### 2.3 用户特征
- **目标用户**: 普通电脑用户，无需专业视频编辑知识
- **使用场景**: 压缩视频以节省存储空间、便于网络传输分享

### 2.4 运行环境
- **操作系统**: Windows 10/11（主要）、macOS、Linux
- **Python 版本**: Python 3.8+
- **依赖组件**: FFmpeg（内置或系统安装）
- **界面框架**: PyQt5 >= 5.15.0

---

## 3. 功能需求

### 3.1 文件管理模块

#### FR-001 文件添加 - 拖拽方式
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 用户可通过拖拽将视频文件添加到应用程序 |
| 输入 | 用户将文件拖拽到拖拽区域 |
| 处理 | 1. 验证文件格式是否支持<br>2. 使用 ffprobe 获取视频元信息<br>3. 添加到文件列表 |
| 输出 | 文件列表更新，显示文件名、大小、时长 |

#### FR-002 文件添加 - 对话框方式
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 用户可通过文件选择对话框添加视频文件 |
| 输入 | 用户点击"选择文件"按钮 |
| 处理 | 打开文件选择对话框，支持多选 |
| 输出 | 选中的文件添加到列表 |

#### FR-003 支持的视频格式
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 系统支持以下视频格式 |
| 格式列表 | MP4, MOV, AVI, MKV, WMV, FLV, WEBM, M4V |

#### FR-004 文件列表显示
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 以表格形式显示已添加的视频文件 |
| 显示列 | 文件名、大小、时长、状态 |
| 状态值 | 等待中、压缩中、完成、失败、已取消 |

#### FR-005 文件移除
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 用户可从列表中移除选中的文件 |
| 触发方式 | Delete 键、右键菜单 |

#### FR-006 清空列表
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 一键清空所有已添加的文件 |
| 触发方式 | "清空列表"按钮、右键菜单 |

---

### 3.2 压缩设置模块

#### FR-010 质量等级选择（简单模式）
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 提供三个预设质量等级供用户选择 |

| 等级 | CRF值 | 预设速度 | 说明 | 预估压缩率 |
|------|-------|----------|------|-----------|
| 高质量 | 18 | slow | 视觉无损，适合存档 | 30-50% |
| 中等质量 | 23 | medium | 平衡质量与大小 | 50-70% |
| 低质量 | 28 | fast | 最小体积，适合分享 | 70-90% |

#### FR-011 压缩模式选择
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 提供三种压缩策略 |

| 模式 | 说明 | 参数 |
|------|------|------|
| 按质量 | 使用 CRF 恒定质量模式 | CRF 值由质量等级决定 |
| 按比例 | 压缩到原始大小的指定百分比 | 5% - 95% |
| 按大小 | 压缩到指定的目标文件大小 | 1 - 10000 MB |

#### FR-012 高级选项 - 视频编码器
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 允许用户选择视频编码器 |
| 选项 | H.264 (libx264)、H.265/HEVC (libx265) |
| 默认值 | H.264 |
| 备注 | H.265 在相同质量下文件更小，但编码较慢 |

#### FR-013 高级选项 - 视频码率
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 手动指定视频码率 |
| 选项 | 自动、1000/2000/4000/6000/8000 kbps、自定义 |
| 自定义范围 | 100 - 50000 kbps |

#### FR-014 高级选项 - 分辨率
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 调整输出视频分辨率 |
| 选项 | 保持原始、1080p、720p、480p、自定义 |
| 自定义范围 | 宽 100-7680、高 100-4320 |
| 特性 | 保持宽高比、不放大、宽高保证偶数 |

#### FR-015 高级选项 - 帧率
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 调整输出视频帧率 |
| 选项 | 保持原始、24fps、30fps、60fps、自定义 |
| 自定义范围 | 1 - 120 fps |

#### FR-016 高级选项 - 音频设置
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 配置音频编码参数 |
| 音频码率选项 | 64、128、192、256、320 kbps |
| 默认码率 | 192 kbps |
| 保留音频 | 可选择移除音频轨道 |
| 音频编码器 | AAC |

---

### 3.3 输出设置模块

#### FR-020 输出目录设置
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 设置压缩后视频的保存位置 |
| 默认值 | ~/Videos/Compressed |
| 操作 | 手动输入路径或浏览选择 |
| 自动创建 | 目录不存在时自动创建 |

#### FR-021 输出文件命名
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 定义输出文件的命名规则 |
| 格式 | {原始文件名}{后缀}.{原始扩展名} |
| 默认后缀 | _compressed |
| 示例 | video.mp4 → video_compressed.mp4 |

---

### 3.4 压缩执行模块

#### FR-030 单文件压缩
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 执行单个视频文件的压缩 |
| 后台执行 | 在独立线程中运行，不阻塞UI |
| 实时进度 | 解析 FFmpeg 输出获取进度百分比 |

#### FR-031 批量压缩
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 按顺序依次压缩多个视频文件 |
| 执行方式 | 串行处理，一个完成后开始下一个 |
| 进度显示 | 当前文件进度 + 总体进度（n/total） |

#### FR-032 取消压缩
| 属性 | 描述 |
|------|------|
| 优先级 | 高 |
| 描述 | 中止正在进行的压缩任务 |
| 确认提示 | 显示确认对话框 |
| 清理操作 | 删除未完成的输出文件 |

#### FR-033 暂停/恢复压缩
| 属性 | 描述 |
|------|------|
| 优先级 | 低 |
| 描述 | 暂停和恢复压缩进程 |
| 实现方式 | 线程事件控制 |
| 当前状态 | 已实现但未在 UI 中暴露 |

---

### 3.5 完成后操作模块

#### FR-040 打开输出目录
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 压缩完成后自动打开输出文件夹 |
| 默认状态 | 启用 |
| 可配置 | 复选框控制 |

#### FR-041 播放提示音
| 属性 | 描述 |
|------|------|
| 优先级 | 低 |
| 描述 | 压缩完成后播放系统提示音 |
| 默认状态 | 禁用 |
| 实现 | Windows: winsound.MessageBeep |

#### FR-042 结果统计显示
| 属性 | 描述 |
|------|------|
| 优先级 | 中 |
| 描述 | 显示压缩结果统计对话框 |
| 显示内容 | 成功数量、原始总大小、压缩后总大小、压缩率 |

---

## 4. 非功能需求

### 4.1 性能需求

| 编号 | 需求描述 |
|------|----------|
| NFR-001 | 界面响应时间 < 100ms |
| NFR-002 | 进度更新频率 >= 每秒1次 |
| NFR-003 | 支持处理 >= 10GB 的视频文件 |
| NFR-004 | 文件列表支持 >= 100 个文件 |

### 4.2 可用性需求

| 编号 | 需求描述 |
|------|----------|
| NFR-010 | 界面语言：中文 |
| NFR-011 | 支持高 DPI 显示器缩放 |
| NFR-012 | 直观的拖拽操作 |
| NFR-013 | 清晰的进度反馈 |

### 4.3 可靠性需求

| 编号 | 需求描述 |
|------|----------|
| NFR-020 | FFmpeg 未安装时提示用户 |
| NFR-021 | 压缩失败时保留原始文件 |
| NFR-022 | 取消时清理临时文件 |
| NFR-023 | 关闭窗口前确认正在进行的任务 |

### 4.4 兼容性需求

| 编号 | 需求描述 |
|------|----------|
| NFR-030 | Windows 10/11 完全支持 |
| NFR-031 | 跨平台代码设计（macOS/Linux 可扩展） |
| NFR-032 | 内置 FFmpeg 或使用系统 FFmpeg |

---

## 5. 系统架构

### 5.1 模块结构

```
video_compressor/
├── main.py                 # 程序入口
├── requirements.txt        # Python 依赖
├── run.bat                 # Windows 启动脚本
├── test_env.py             # 环境测试脚本
├── 启动说明.md              # 启动说明文档
├── core/                   # 核心业务逻辑
│   ├── __init__.py
│   ├── compressor.py       # 压缩器（VideoCompressor, BatchCompressor）
│   ├── presets.py          # 预设配置（质量等级、编码参数）
│   └── utils.py            # 工具函数（格式转换、视频信息获取）
├── ui/                     # 用户界面
│   ├── __init__.py
│   ├── main_window.py      # 主窗口
│   ├── file_list.py        # 文件列表组件（DropZone, FileListWidget）
│   └── settings.py         # 设置面板组件
├── tests/                  # 单元测试
│   ├── __init__.py
│   ├── test_compressor.py  # 压缩器测试
│   ├── test_presets.py     # 预设配置测试
│   └── test_utils.py       # 工具函数测试
├── doc/                    # 项目文档
│   ├── 软件需求规格说明书.md
│   ├── 软件架构设计文档.md
│   └── 详细设计文档.md
└── ffmpeg/                 # 内置 FFmpeg（可选）
    └── bin/
        ├── ffmpeg.exe
        └── ffprobe.exe
```

### 5.2 数据流

```
┌─────────┐    添加文件    ┌──────────────┐
│  用户    │─────────────→│  文件列表     │
└─────────┘               └──────────────┘
     │                          │
     │ 配置设置                  │ 获取文件路径
     ↓                          ↓
┌─────────────┐           ┌──────────────┐
│  设置面板    │──────────→│  批量压缩器   │
└─────────────┘  压缩设置  └──────────────┘
                               │
                               │ 调用 FFmpeg
                               ↓
                          ┌──────────────┐
                          │   FFmpeg     │
                          └──────────────┘
                               │
                               │ 输出视频
                               ↓
                          ┌──────────────┐
                          │  输出目录     │
                          └──────────────┘
```

### 5.3 信号机制

| 信号 | 发送者 | 描述 |
|------|--------|------|
| `progress_updated(float)` | VideoCompressor | 当前文件进度 0-100 |
| `status_updated(str)` | VideoCompressor | 状态文字更新 |
| `compression_finished(result)` | VideoCompressor | 单文件压缩完成 |
| `compression_error(str)` | VideoCompressor | 压缩错误 |
| `file_started(index, name)` | BatchCompressor | 开始处理某文件 |
| `file_progress(index, float)` | BatchCompressor | 某文件进度 |
| `file_finished(index, result)` | BatchCompressor | 某文件完成 |
| `batch_finished(list)` | BatchCompressor | 批量完成 |
| `batch_cancelled()` | BatchCompressor | 批量取消 |
| `files_dropped(list)` | DropZone | 文件拖入 |
| `files_changed()` | FileListWidget | 文件列表变化 |
| `settings_changed()` | SettingsPanel | 设置变更 |

---

## 6. 数据字典

### 6.1 CompressionSettings（压缩设置）

| 字段 | 类型 | 默认值 | 说明 |
|------|------|--------|------|
| quality_level | QualityLevel | MEDIUM | 质量等级 |
| video_codec | VideoCodec | H264 | 视频编码器 |
| video_bitrate | int/None | None | 视频码率(kbps) |
| resolution | Resolution | ORIGINAL | 分辨率预设 |
| custom_width | int/None | None | 自定义宽度 |
| custom_height | int/None | None | 自定义高度 |
| frame_rate | FrameRate | ORIGINAL | 帧率预设 |
| custom_fps | int/None | None | 自定义帧率 |
| audio_bitrate | int | 192 | 音频码率(kbps) |
| keep_audio | bool | True | 保留音频 |
| use_advanced | bool | False | 使用高级模式 |
| compression_mode | CompressionMode | QUALITY | 压缩模式 |
| target_ratio | int | 50 | 目标压缩比例(%) |
| target_size_mb | float | 0 | 目标大小(MB) |

### 6.2 CompressionResult（压缩结果）

| 字段 | 类型 | 说明 |
|------|------|------|
| success | bool | 是否成功 |
| input_path | str | 输入文件路径 |
| output_path | str | 输出文件路径 |
| original_size | int | 原始文件大小(bytes) |
| compressed_size | int | 压缩后大小(bytes) |
| error_message | str | 错误信息 |

### 6.3 视频信息（video_info）

| 字段 | 类型 | 说明 |
|------|------|------|
| file_path | str | 文件路径 |
| file_name | str | 文件名 |
| file_size | int | 文件大小(bytes) |
| duration | float | 时长(秒) |
| bit_rate | int | 总码率 |
| format_name | str | 格式名称 |
| width | int | 视频宽度 |
| height | int | 视频高度 |
| video_codec | str | 视频编码 |
| video_bit_rate | int | 视频码率 |
| fps | float | 帧率 |
| audio_codec | str | 音频编码 |
| audio_bit_rate | int | 音频码率 |
| sample_rate | int | 采样率 |
| channels | int | 声道数 |

---

## 7. 外部接口

### 7.1 FFmpeg 命令行接口

**基本压缩命令模板**:
```bash
ffmpeg -y -i {input}
    -c:v {video_codec}
    [-crf {crf}]
    [-b:v {video_bitrate}]
    [-preset {preset}]
    [-vf scale={width}:{height}]
    [-r {fps}]
    [-c:a aac -b:a {audio_bitrate}] | [-an]
    [-tag:v hvc1]  # H.265 兼容性
    {output}
```

### 7.2 FFprobe 视频信息查询

```bash
ffprobe -v quiet -print_format json -show_format -show_streams {input}
```

---

## 8. 约束与限制

### 8.1 技术约束
- 依赖 FFmpeg 进行视频编解码
- PyQt5 仅支持 Python 3.x
- H.265 编码需要 FFmpeg 包含 libx265

### 8.2 已知限制
- 暂停功能未在 UI 中暴露
- 不支持硬件加速编码（NVENC/QSV）
- 不支持视频预览
- 不支持多线程并行压缩多个文件

---

## 9. 未来扩展

| 功能 | 优先级 | 说明 |
|------|--------|------|
| 硬件加速 | 高 | 支持 NVIDIA NVENC、Intel QSV |
| 视频预览 | 中 | 压缩前/后对比预览 |
| 多任务并行 | 中 | 同时压缩多个文件 |
| 暂停/恢复 UI | 低 | 在界面上暴露暂停功能 |
| 预设管理 | 低 | 保存和加载自定义预设 |
| 英文界面 | 低 | 多语言支持 |

---

## 10. 修订历史

| 版本 | 日期 | 作者 | 说明 |
|------|------|------|------|
| 1.0 | 2026-01-18 | - | 初始版本 |

---

*文档结束*
